<script>
  import Row from "../row/index.svelte";
  import { onMount } from "svelte";
  import { isIE11, isEdge } from "../../utils/toolbox/src/browsers/browser-type";

  export let headerContainer,
    gridLayout,
    element,
    bodyContentOverflowed,
    bodyWidthOverflowed,
    hoveredColumnIndex,
    gridData,
    gridDimensions,
    parsedGridConfig,
    vizRecDomain,
    handleFilter,
    filterSelectData,
    filterData,
    searchable,
    isSearchEnabled,
    parent,
    stores,
    hoveredGroupDetails,
    applyConditionalFilter;
  onMount(() => {
    headerContainer.node = element;
  });
  let totalWidth,
    headerRowHeight,
		scrollerPadding,
    rowStyle,
    searchRowStyle,
    width,
    childRef,
    groupLevelCount,
    rowheight,
    groupRowStyle;
  $: {
    totalWidth = gridLayout.totalWidth;
    headerRowHeight = gridLayout.headerDimState.height;
    scrollerPadding = bodyWidthOverflowed && bodyContentOverflowed && (isIE11 || isEdge) ? 19 : 0; // default scroll width in IE is 19px
    width = gridDimensions.width;
    searchable = parsedGridConfig.defaultcolumnoptions.searchable;
    groupLevelCount = parent._gridConfig.totalLevel;
    if(typeof searchable === 'boolean'){
      isSearchEnabled = searchable;
    } else if(typeof searchable === 'object'){
      isSearchEnabled = searchable.enable;
    }

    if(groupLevelCount > 0 && isSearchEnabled){
      rowheight = (headerRowHeight / (groupLevelCount + 2));
    } else if(!groupLevelCount > 0 && isSearchEnabled){
      rowheight = headerRowHeight / 2;
    } else if(groupLevelCount > 0){
      rowheight = headerRowHeight / (groupLevelCount + 1);
    } else {
      rowheight = headerRowHeight;
    }
    rowStyle =
      "top:" + rowheight * groupLevelCount +  "px;height:" +
      rowheight +
      "px;width:" +
      (totalWidth + scrollerPadding) +
      "px;";
    searchRowStyle = 
    "top:" + (rowheight + (groupLevelCount && groupLevelCount !== 0 ? groupLevelCount * rowheight : 0)) +"px;height:" +
      (rowheight) +
      "px;width:" +
      (totalWidth + scrollerPadding) +
      "px;";
    groupRowStyle =
      "width:" +
      (totalWidth + scrollerPadding) +
      "px;";
  }
  export function resetSearchValues(name){
    childRef.resetSearchValues(name);
  }
</script>
<div
  class="fg-header-container"
  bind:this={element}
  style="height: {headerRowHeight}px">
  {#if groupLevelCount > 0}
    <Row
    parent={parent}
    handleFilter={handleFilter}
    filterSelectData={filterSelectData}
    filterData={filterData}
    {gridData}
    {vizRecDomain}
    {gridLayout}
    {stores}
    quickSearchEnabled={isSearchEnabled}
    bind:this={childRef}
    type="header"
    style={`top:0px;height:${rowheight * groupLevelCount}px;${groupRowStyle}`}
    {hoveredColumnIndex}
    {hoveredGroupDetails}
    {parsedGridConfig}
    groupedHeader={true}
    {rowheight}
    on:cellHoverIn
    on:cellHoverOut 
    {applyConditionalFilter}
    />
  {/if}
  <Row
    parent={parent}
    {gridData}
    handleFilter={handleFilter}
      filterSelectData={filterSelectData}
      filterData={filterData}
    {vizRecDomain}
    {gridLayout}
    {stores}
    quickSearchEnabled={isSearchEnabled}
    bind:this={childRef}
    type="header"
    style={rowStyle}
    {rowheight}
    {hoveredColumnIndex}
    {hoveredGroupDetails}
    {parsedGridConfig}
    on:cellHoverIn
    on:cellHoverOut 
    {applyConditionalFilter}
    />
  {#if isSearchEnabled }
  <Row
    parent={parent}
    {gridData}
    handleFilter={handleFilter}
    filterSelectData={filterSelectData}
    filterData={filterData}
    {stores}
    bind:this={childRef}
    {vizRecDomain}
    {gridLayout}
    type="header"
    style={searchRowStyle}
    {rowheight}
    {hoveredColumnIndex}
    {hoveredGroupDetails}
    {parsedGridConfig}
    isSearchEnabled={true} 
    {applyConditionalFilter}
    />
  {/if}
</div>
